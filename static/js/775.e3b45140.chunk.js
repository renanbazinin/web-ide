"use strict";(globalThis.webpackChunk_nand2tetris_web=globalThis.webpackChunk_nand2tetris_web||[]).push([[775],{2775:(e,t,n)=>{n.r(t),n.d(t,{BitmapEditor:()=>h,default:()=>f});var a=n(8878),r=n(5168),l=n(782);const s="bitmap_editor_state",o="bitmap_editor_grid",i={width:48,height:32,pixelSize:16,currentIShift:0,currentJShift:0,marginSaveFrames:1,baseI:0,baseJ:0,drawHeight:0,invertMode:!1,comments:!0};function c(e,t,n,a,r){let l="";for(let i=n;i<n+16;i++)l=i<0||i>=r?(a?"1":"0")+l:(e[t][i]?"1":"0")+l;let s=!1;if("1"===l[0]){s=!0;let e="";for(let t=0;t<16;t++)e+="1"===l[t]?"0":"1";l=e}let o=0;for(let i=0;i<16;i++)o*=2,"1"===l[i]&&(o+=1);return s&&(o=-(o+1)),o}function d(e,t,n){let a=32*e+n,r="";return r=a>0?" +"+a:0===a?"":" "+a,-32768===t?"\tdo Memory.poke(memAddress"+r+", ~32767);\n":"\tdo Memory.poke(memAddress"+r+", "+t+");\n"}function u(e,t,n,a){let r="";const l=a?["// D holds previous addr","// D holds addr","// D holds addr","// A holds val","// D = addr + val","// A=addr + val - val = addr","// RAM[addr] = val","// RAM[addr]=-val"]:["","","","","","","",""];return!n&&e>2&&(r+="\tD=A "+l[0]+"\n"),1===e?r+="\tAD=A+1 "+l[1]+"\n":2===e?r+="\tAD=A+1\n\tAD=A+1 "+l[2]+"\n":0!==e&&(r+="\t@"+e+"\n\tAD=D+A\n"),1===t||0===t||-1===t?(r+="\tM="+t.toString()+"\n",{code:r,dHoldsAddr:!0}):-32768===t?(r+="\t@32767\n\tA=!A "+l[3]+"\n\tD=D+A "+l[4]+"\n\tA=D-A "+l[5]+"\n",r+="\tM=D-A "+l[6]+"\n",{code:r,dHoldsAddr:!1}):t<0?(r+="\t@"+-t+" "+l[3]+"\n\tD=D+A "+l[4]+"\n\tA=D-A "+l[5]+"\n",r+="\tM=A-D "+l[7]+"\n",{code:r,dHoldsAddr:!1}):(r+="\t@"+t+" "+l[3]+"\n\tD=D+A "+l[4]+"\n\tA=D-A "+l[5]+"\n",r+="\tM=D-A "+l[6]+"\n",{code:r,dHoldsAddr:!1})}const h=()=>{const e=(e,t,n)=>{const a=[];for(let r=0;r<t;r++)a[r]=new Array(e).fill(n);return a},t=(()=>{try{const e=localStorage.getItem(s);if(e)return{...i,...JSON.parse(e)}}catch(e){console.error("Error loading bitmap editor state:",e)}return i})(),[n,h]=(0,a.useState)(t.width),[f,m]=(0,a.useState)(t.height),[p,v]=(0,a.useState)(t.pixelSize),[g,x]=(0,a.useState)(t.currentIShift),[b,j]=(0,a.useState)(t.currentJShift),[k,S]=(0,a.useState)(t.marginSaveFrames),[C,w]=(0,a.useState)(t.invertMode),[A,y]=(0,a.useState)(t.comments),[M,N]=(0,a.useState)(()=>((t,n,a)=>{try{const e=localStorage.getItem(o);if(e){const t=JSON.parse(e);if(Array.isArray(t)&&t.length>0)return t}}catch(r){console.error("Error loading bitmap editor grid:",r)}return e(t,n,a)})(t.width,t.height,t.invertMode)),[D,I]=(0,a.useState)(null),[R,z]=(0,a.useState)("jack"),[F,J]=(0,a.useState)(!1),[P,H]=(0,a.useState)("fitToDrawing"),[O,T]=(0,a.useState)(!1),[E,L]=(0,a.useState)(!0),B=(0,a.useRef)(null),_=(0,a.useRef)(null),$=(0,a.useRef)(null),G=(0,a.useRef)(null),U=(0,a.useRef)(null);(0,a.useEffect)(()=>{const e={width:n,height:f,pixelSize:p,currentIShift:g,currentJShift:b,marginSaveFrames:k,baseI:0,baseJ:0,drawHeight:0,invertMode:C,comments:A};localStorage.setItem(s,JSON.stringify(e))},[n,f,p,g,b,k,C,A]),(0,a.useEffect)(()=>{localStorage.setItem(o,JSON.stringify(M))},[M]);const V=(0,a.useCallback)(()=>{const e={};let t=0,a=n-1,r=0,l=f-1,s=0,o=f-1;if("fullCanvas"!==P){let e=!1;for(let a=0;a<n&&!e;a++)for(let n=f-1;n>=0;n--){var i;if((null===(i=M[n])||void 0===i?void 0:i[a])!==C){t=a,e=!0;break}}e=!1;for(let t=n-1;t>=0&&!e;t--)for(let n=f-1;n>=0;n--){var c;if((null===(c=M[n])||void 0===c?void 0:c[t])!==C){a=t,e=!0;break}}e=!1;for(let t=f-1;t>=0&&!e;t--)for(let a=0;a<n;a++){var d;if((null===(d=M[t])||void 0===d?void 0:d[a])!==C){l=t,e=!0;break}}e=!1;for(let t=0;t<f&&!e;t++)for(let a=0;a<n;a++){var u;if((null===(u=M[t])||void 0===u?void 0:u[a])!==C){s=t,e=!0;break}}r=t-b,o=l-g,a=Math.max(a,a-b),t=Math.min(t,t-b)}const h=function(e,t,n){const a=Math.min(0,-Math.ceil((n-e)/16)),r=Math.max(0,Math.floor((t-n)/16)),l=[];for(let s=a;s<r+1;s++)l.push(s);if(t<n||e>n+16){const e=l.indexOf(0);-1!==e&&l.splice(e,1)}return l}(t,a,r);for(const x of h){const t=[],a=16*x+r;if("fullCanvas"===P)for(let e=0;e<f;e++)t.push([e,a]);else if("rectangular"===P){const e=Math.min(s,o),n=Math.max(l,o);for(let r=e;r<=n;r++)r<0||r>=f||t.push([r,a])}else{const e=new Set,r=Math.min(s,o),i=Math.max(l,o);for(let t=r;t<=i;t++){if(t<0||t>=f)continue;let r=!1;for(let e=a;e<a+16;e++)if(e>=0&&e<n){var m;if((null===(m=M[t])||void 0===m?void 0:m[e])!==C){r=!0;break}if(b>0)for(let e=a+16;e<Math.min(b,k)+a+16;e++){var p;if(e>=n)break;if((null===(p=M[t])||void 0===p?void 0:p[e])!==C){r=!0;break}}else if(b<0)for(let e=a-1;e>Math.max(b,-k)+a-1;e--){var v;if(e<0)break;if((null===(v=M[t])||void 0===v?void 0:v[e])!==C){r=!0;break}}}if(r){e.add(t);const n=Math.min(t,t-g),a=Math.max(t,t-g);for(let t=n;t<=a;t++)t>=0&&t<f&&e.add(t)}}for(const n of e)t.push([n,a])}e[x.toString()]=t}return{words:e,baseI:o,baseJ:r,columns:h,drawHeight:Math.max(l,o)-Math.min(s,o)}},[M,n,f,C,P,g,b,k]),Z=(0,a.useMemo)(()=>{if(F)return"";const{words:e,baseI:t,columns:a,drawHeight:r}=V(),l=E?r:0;if("jack"===R){let r="function void draw(int location) {\n\tvar int memAddress; \n\tlet memAddress = 16384+location;\n";for(const s of a){A&&(r+="\t// column "+s+"\n");const a=e[s.toString()]||[];for(const[e,o]of a){r+=d(e-t+l,c(M,e,o,C,n),s)}}return r+="\treturn;\n}",r}{const t={};for(const n in e)for(const a of e[n]){const e=a[0].toString();t[e]||(t[e]=[]),t[e].push({coords:a,col:n})}let a="(draw)\n";A&&(a+="\t// put bitmap location value in R12\n\t// put code return address in R13\n"),a+="\t@SCREEN\n\tD=A\n\t@R12\n\tAD=D+M\n";let r=!0,l=null,s=null;const o=Object.keys(t).map(Number).sort((e,t)=>e-t);for(const e of o){A&&(a+="\t// row "+(e+1)+"\n");for(const o of t[e.toString()]){const{coords:e,col:t}=o,i=c(M,e[0],e[1],C,n);let d=0;null!==l&&null!==s&&(d=32*(e[0]-l[0])+(parseInt(t)-parseInt(s)));const h=u(d,i,r,A);r=h.dHoldsAddr,a+=h.code,l=e,s=t}}return A&&(a+="\t// return\n"),a+="\t@R13\n\tA=M\n\tD;JMP\n",a}},[M,R,A,F,V,C,n,E]),W=(0,a.useMemo)(()=>{if(!O)return new Set;const{columns:e,baseJ:t}=V(),n=new Set;for(const a of e)n.add(16*a+t);return n},[O,V]),q=(0,a.useCallback)((e,t)=>{const n=!M[e][t];I(n),N(a=>{const r=a.map(e=>[...e]);return r[e][t]=n,r})},[M]),K=(0,a.useCallback)((e,t)=>{null!==D&&N(n=>{const a=n.map(e=>[...e]);return a[e][t]=D,a})},[D]),Q=(0,a.useCallback)(()=>{I(null)},[]),X=(0,a.useCallback)(()=>{var t,n,a;const r=16*Math.floor(parseInt((null===(t=B.current)||void 0===t?void 0:t.value)||"48")/16),l=parseInt((null===(n=_.current)||void 0===n?void 0:n.value)||"32"),s=parseInt((null===(a=$.current)||void 0===a?void 0:a.value)||"16");isNaN(r)||isNaN(l)||isNaN(s)||(h(r),m(l),v(s),N(t=>{const n=e(r,l,C);for(let e=0;e<Math.min(l,t.length);e++)for(let l=0;l<Math.min(r,(null===(a=t[e])||void 0===a?void 0:a.length)||0);l++){var a;n[e][l]=t[e][l]}return n}))},[C]),Y=(0,a.useCallback)(()=>{h(i.width),m(i.height),v(i.pixelSize),x(0),j(0),S(1),w(!1),y(!0),N(e(i.width,i.height,!1)),B.current&&(B.current.value=i.width.toString()),_.current&&(_.current.value=i.height.toString()),$.current&&($.current.value=i.pixelSize.toString()),G.current&&(G.current.value="1")},[]),ee=(0,a.useCallback)(()=>{j(e=>e-1),N(e=>e.map(e=>{const t=[...e];for(let a=0;a<n-1;a++)t[a]=e[a+1];return t[n-1]=C,t}))},[n,C]),te=(0,a.useCallback)(()=>{j(e=>e+1),N(e=>e.map(e=>{const t=[...e];for(let a=n-1;a>0;a--)t[a]=e[a-1];return t[0]=C,t}))},[n,C]),ne=(0,a.useCallback)(()=>{x(e=>e-1),N(e=>{const t=e.map(e=>[...e]);for(let n=0;n<f-1;n++)t[n]=[...e[n+1]];return t[f-1]=new Array(n).fill(C),t})},[f,n,C]),ae=(0,a.useCallback)(()=>{x(e=>e+1),N(e=>{const t=e.map(e=>[...e]);for(let n=f-1;n>0;n--)t[n]=[...e[n-1]];return t[0]=new Array(n).fill(C),t})},[f,n,C]),re=(0,a.useCallback)(()=>{x(0),j(0)},[]),le=(0,a.useCallback)(()=>{f===n&&(N(t=>{const a=e(n,f,C);for(let e=0;e<f;e++)for(let r=0;r<n;r++)a[r][f-1-e]=t[e][r];return a}),re())},[f,n,C,re]),se=(0,a.useCallback)(()=>{N(e=>e.map(e=>{const t=[...e];for(let a=0;a<n;a++)t[a]=e[n-1-a];return t}))},[n]),oe=(0,a.useCallback)(()=>{N(e=>e.map(e=>e.map(e=>!e)))},[]),ie=(0,a.useCallback)(()=>{var e;let t=parseInt((null===(e=G.current)||void 0===e?void 0:e.value)||"1");t<1&&(t=1),S(t)},[]),ce=(0,a.useCallback)(e=>{var t;const n=null===(t=e.target.files)||void 0===t?void 0:t[0];if(!n)return;const a=n.name.toLowerCase().split(".").pop();if("bmp"===a){const e=new FileReader;e.onload=e=>{var t;const n=new Uint8Array(null===(t=e.target)||void 0===t?void 0:t.result);de(n)},e.readAsArrayBuffer(n)}else"png"===a?ue(n):alert("This file type is not supported. Please upload a .bmp (24-bit) or .png image.");e.target.value=""},[]),de=(0,a.useCallback)(e=>{const t=e[18]+(e[19]<<8),n=e[22]+(e[23]<<8),a=e[10]+(e[11]<<8);if(24!==e[28])return void alert("Only 24-bit BMP files are supported. Please convert your BMP file to a 24-bit depth bitmap.");const r=4*Math.floor((24*t+31)/32),l=16*Math.ceil(t/16),s=n,o=[];for(let i=0;i<s;i++)o[i]=new Array(l).fill(!1);for(let i=0;i<n;i++){const l=n-1-i;for(let n=0;n<t;n++){const t=a+l*r+3*n,s=e[t],c=e[t+1],d=(e[t+2]+c+s)/3;o[i][n]=d<128}}h(l),m(s),N(o)},[]),ue=(0,a.useCallback)(e=>{const t=new Image,n=new FileReader;n.onload=e=>{var n;t.src=null===(n=e.target)||void 0===n?void 0:n.result},n.readAsDataURL(e),t.onload=()=>{const e=16*Math.ceil(t.width/16),n=t.height,a=document.createElement("canvas");a.width=e,a.height=n;const r=a.getContext("2d");if(!r)return;r.fillStyle="#ffffff",r.fillRect(0,0,e,n),r.drawImage(t,0,0);const l=r.getImageData(0,0,e,n).data,s=[];for(let t=0;t<n;t++){s[t]=new Array(e).fill(!1);for(let n=0;n<e;n++){const a=4*(t*e+n),r=l[a],o=l[a+1],i=l[a+2],c=l[a+3],d=(r+o+i)/3;s[t][n]=c>0&&d<250}}h(e),m(n),N(s)}},[]);return(0,l.jsxs)("div",{className:"Page BitmapPage grid",onMouseUp:Q,onMouseLeave:Q,children:[(0,l.jsx)(r.Z,{className:"canvas-panel",header:(0,l.jsxs)("div",{className:"canvas-size-controls",children:[(0,l.jsx)("label",{htmlFor:"inputWidth",children:"Canvas Size:"}),(0,l.jsx)("input",{ref:B,id:"inputWidth",type:"text",placeholder:"width",maxLength:3,defaultValue:n}),(0,l.jsx)("span",{children:"x"}),(0,l.jsx)("input",{ref:_,id:"inputHeight",type:"text",placeholder:"height",maxLength:3,defaultValue:f}),(0,l.jsx)("label",{htmlFor:"pixelSize",children:"Pixel size:"}),(0,l.jsx)("input",{ref:$,id:"pixelSize",type:"text",placeholder:"px",maxLength:2,defaultValue:p}),(0,l.jsx)("button",{onClick:X,title:"Resize Canvas Preserving Upper-left Contents",children:"Resize"}),(0,l.jsx)("button",{onClick:Y,title:"Reset Canvas Size, Settings, and Clear Contents",children:"Reset"})]}),children:(0,l.jsx)("div",{style:{overflow:"auto",padding:"var(--spacing)"},children:(0,l.jsx)("table",{className:"canvas-grid "+(O?"obvious-edges":""),onMouseLeave:Q,children:(0,l.jsxs)("tbody",{children:[(0,l.jsxs)("tr",{children:[(0,l.jsx)("td",{}),Array.from({length:n},(e,t)=>(0,l.jsx)("td",{className:"col-label",style:{fontSize:.6*p+"px"},children:t+1},`col-${t}`))]}),Array.from({length:f},(e,t)=>(0,l.jsxs)("tr",{children:[(0,l.jsx)("td",{className:"row-label",style:{fontSize:.6*p+"px"},children:t+1}),Array.from({length:n},(e,n)=>{var a;return(0,l.jsx)("td",{className:`cell ${null!==(a=M[t])&&void 0!==a&&a[n]?"filled":"empty"} ${W.has(n)?"word-edge":""}`,style:{width:p,height:p},onMouseDown:()=>q(t,n),onMouseOver:()=>K(t,n)},`cell-${t}-${n}`)})]},`row-${t}`))]})})})}),(0,l.jsx)(r.Z,{className:"code-panel",header:(0,l.jsxs)("div",{className:"tab-container",children:[(0,l.jsx)("button",{className:"tab-button "+("jack"===R?"active":""),onClick:()=>z("jack"),children:"Generated Jack Code"}),(0,l.jsx)("button",{className:"tab-button "+("hack"===R?"active":""),onClick:()=>z("hack"),children:"Generated Hack Assembly"})]}),children:(0,l.jsx)("textarea",{className:"generated-code",readOnly:!0,value:Z})}),(0,l.jsxs)(r.Z,{className:"controls-panel",children:[(0,l.jsxs)("div",{className:"control-row",children:[(0,l.jsx)("input",{ref:U,type:"file",className:"hidden-file-input",accept:".bmp, .png, image/bmp, image/png",onChange:ce}),(0,l.jsx)("button",{onClick:()=>{var e;return null===(e=U.current)||void 0===e?void 0:e.click()},title:"Import BMP (24-bit) or PNG (black and white) file",children:"Import Image"}),(0,l.jsxs)("div",{className:"button-group",children:[(0,l.jsx)("button",{onClick:ee,children:"Shift left <"}),(0,l.jsx)("button",{onClick:te,children:"Shift right >"}),(0,l.jsx)("button",{onClick:ne,children:"Shift up ^"}),(0,l.jsx)("button",{onClick:ae,children:"Shift down v"}),(0,l.jsx)("button",{onClick:re,children:"Clear Shifting"})]}),(0,l.jsx)("div",{className:"spacer"}),(0,l.jsxs)("div",{className:"button-group",children:[(0,l.jsx)("button",{onClick:le,disabled:n!==f,children:"Rotate right"}),(0,l.jsx)("button",{onClick:se,children:"Flip horizontally"}),(0,l.jsx)("button",{onClick:oe,children:"Invert"})]}),(0,l.jsx)("div",{className:"checkbox-group",children:(0,l.jsxs)("label",{children:[(0,l.jsx)("input",{type:"checkbox",checked:C,onChange:e=>w(e.target.checked)}),"Inverted Mode"]})}),(0,l.jsx)("div",{className:"spacer"}),(0,l.jsxs)("div",{className:"checkbox-group",children:[(0,l.jsxs)("label",{children:[(0,l.jsx)("input",{type:"checkbox",checked:F,onChange:e=>J(e.target.checked)}),"Pause Code Generation"]}),(0,l.jsxs)("label",{children:[(0,l.jsx)("input",{type:"checkbox",checked:A,onChange:e=>y(e.target.checked)}),"Comments On"]}),(0,l.jsxs)("label",{children:[(0,l.jsx)("input",{type:"checkbox",checked:O,onChange:e=>T(e.target.checked)}),"Obvious Word Edges"]})]})]}),(0,l.jsxs)("div",{className:"control-row",children:[(0,l.jsxs)("div",{className:"radio-group",children:[(0,l.jsxs)("label",{children:[(0,l.jsx)("input",{type:"radio",name:"marginType",checked:"fitToDrawing"===P,onChange:()=>H("fitToDrawing")}),"Fit to drawing"]}),(0,l.jsxs)("label",{children:[(0,l.jsx)("input",{type:"radio",name:"marginType",checked:"rectangular"===P,onChange:()=>H("rectangular")}),"Rectangular"]}),(0,l.jsxs)("label",{children:[(0,l.jsx)("input",{type:"radio",name:"marginType",checked:"fullCanvas"===P,onChange:()=>H("fullCanvas")}),"Full Canvas"]})]}),"fitToDrawing"===P&&(0,l.jsxs)("div",{className:"input-group",children:[(0,l.jsx)("label",{htmlFor:"marginSaveFrames",children:"# horizontal shifts per animation frame:"}),(0,l.jsx)("input",{ref:G,id:"marginSaveFrames",type:"text",maxLength:2,defaultValue:k,onChange:ie})]})]}),(0,l.jsxs)("div",{className:"control-row",children:[(0,l.jsx)("span",{children:"Base address:"}),(0,l.jsxs)("div",{className:"radio-group",children:[(0,l.jsxs)("label",{children:[(0,l.jsx)("input",{type:"radio",name:"baseRowFrom",checked:E,onChange:()=>L(!0)}),"Top Left"]}),(0,l.jsxs)("label",{children:[(0,l.jsx)("input",{type:"radio",name:"baseRowFrom",checked:!E,onChange:()=>L(!1)}),"Bottom Left"]})]})]})]})]})},f=h},5168:(e,t,n)=>{n.d(t,{p:()=>l,Z:()=>r});var a=n(782);const r=e=>{var t;return(0,a.jsxs)("article",{className:["panel",null!==(t=e.className)&&void 0!==t?t:"",e.isEditorPanel?"editor":""].join(" "),children:[e.header&&(0,a.jsx)("header",{children:e.header}),(0,a.jsx)("main",{children:e.children}),e.footer&&(0,a.jsx)("footer",{children:e.footer})]})},l=e=>{var t;return(0,a.jsxs)("details",{className:null!==(t=e.className)&&void 0!==t?t:"",open:e.open,style:e.style,children:[(0,a.jsx)("summary",{children:(0,a.jsx)("div",{className:"flex row align-baseline",children:e.summary})}),e.children]})}}}]);