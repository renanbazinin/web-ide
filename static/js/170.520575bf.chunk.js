"use strict";(globalThis.webpackChunk_nand2tetris_web=globalThis.webpackChunk_nand2tetris_web||[]).push([[170],{2240:(e,t,s)=>{s.r(t),s.d(t,{Chip:()=>H,default:()=>$});var n=s(1391),r=s(8256),i=s(8878),a=s(782),o=s(7761),l=s(6980),c=s(2331),d=s(836),u=s(9651),p=s(8739),h=s(7721),x=s(3180);const m=({A:e,op:t,D:s,out:n,flag:r})=>(0,a.jsxs)("div",{className:"alu",children:[(0,a.jsx)("span",{children:"ALU"}),(0,a.jsxs)("svg",{width:"250",height:"250",version:"1.1",children:[(0,a.jsx)("defs",{children:(0,a.jsx)("rect",{x:"34.442518",y:"54.335354",width:"0.91770717",height:"20.780869"})}),(0,a.jsxs)("g",{children:[(0,a.jsx)("polygon",{points:"70,10 180,85 180,165 70,240 70,135 90,125 70,115",stroke:"#000",fill:"#6D97AB"}),(0,a.jsx)("text",{xmlSpace:"preserve",textAnchor:"middle",y:"61",x:"35",children:e}),(0,a.jsx)("text",{xmlSpace:"preserve",textAnchor:"middle",y:"176",x:"35",children:s}),(0,a.jsx)("text",{xmlSpace:"preserve",textAnchor:"middle",y:"121",x:"207",children:n}),(0,a.jsx)("text",{xmlSpace:"preserve",y:"130.50002",x:"110.393929",fill:"#ffffff",fontSize:24,children:p._0.op[t]??"(??)"}),(0,a.jsxs)("g",{children:[(0,a.jsx)("path",{d:"M 6,67.52217 H 68.675994"}),(0,a.jsx)("path",{d:"M 68.479388,67.746136 60.290279,61.90711"}),(0,a.jsx)("path",{d:"m 68.479388,67.40711 -8.189109,5.839026"})]}),(0,a.jsxs)("g",{transform:"translate(0,115.5)",children:[(0,a.jsx)("path",{d:"M 6,67.52217 H 68.675994"}),(0,a.jsx)("path",{d:"M 68.479388,67.746136 60.290279,61.90711"}),(0,a.jsx)("path",{d:"m 68.479388,67.40711 -8.189109,5.839026"})]}),(0,a.jsxs)("g",{transform:"translate(176,57.5)",children:[(0,a.jsx)("path",{d:"M 6,67.52217 H 68.675994"}),(0,a.jsx)("path",{d:"M 68.479388,67.746136 60.290279,61.90711"}),(0,a.jsx)("path",{d:"m 68.479388,67.40711 -8.189109,5.839026"})]})]})]})]});var j=s(7437),g=s(64),f=s(6537),v=s(4668);function b(e){return(0,a.jsx)(g.ce,{name:e.name,memory:e.memory,format:e instanceof o.N4?"asm":"dec",highlight:e.address,count:5})}function y(e,t,s){if(e instanceof l.Hs)return(0,a.jsx)(m,{A:e.in("x").busVoltage,op:e.op(),D:e.in("y").busVoltage,out:e.out().busVoltage,flag:e.out("zr").voltage()===u.RY?p.iI.Zero:e.out("ng").voltage()===u.RY?p.iI.Negative:p.iI.Positive});if(e instanceof c.UZ)return(0,a.jsx)(f.d,{name:e.name??`Chip ${e.id}`,bits:e.bits});if(e instanceof c.PC)return(0,a.jsx)(f.d,{name:"PC",bits:e.bits});if(e instanceof o.s3)return(0,a.jsx)(j.s,{keyboard:e,update:t});if(e instanceof o.ff)return(0,a.jsx)(v.f,{memory:e.memory});if(e instanceof d.XK)return b(e);if(e instanceof d.Z4)return(0,a.jsxs)("span",{children:["RAM ",e.width]});if(e instanceof o.Z8){const t=(0,h.D4)(e.in("instruction").busVoltage);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(f.d,{name:"A",bits:e.state.A}),(0,a.jsx)(f.d,{name:"D",bits:e.state.D}),(0,a.jsx)(f.d,{name:"PC",bits:e.state.PC}),(0,a.jsx)(m,{A:t.am?e.in("inM").busVoltage:e.state.A,D:e.state.D,out:e.state.ALU,op:t.op,flag:e.state.flag})]})}if(e instanceof o.Sc)return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(f.d,{name:"A",bits:e.cpu.state.A}),(0,a.jsx)(f.d,{name:"D",bits:e.cpu.state.D}),(0,a.jsx)(f.d,{name:"PC",bits:e.cpu.state.PC}),!s?.has(x.XC)&&(0,a.jsx)(v.f,{memory:e.ram.screen.memory}),b(e.rom),b(e.ram.ram)]});const n=[...e.parts].map(e=>y(e,t)).filter(e=>void 0!==e);return n.length>0?(0,a.jsx)(a.Fragment,{children:n}):void 0}var C=s(6513),k=s(7490),w=s(9646),A=s(910),N=s(5005),S=s(1091),P=s(9267),D=s(8029),_=s(3344);const E=["01","02","03","05"];var I=s(2675),F=s(5168),R=s(3569);const L={idle:"AI is idle",loading:"Sending HDL to AI...",success:"AI Feedback",error:"AI Error"},B=({open:e,status:t,feedback:s,error:n,onClose:r,onRetry:i})=>{if(!e)return null;const o="function"===typeof i&&"loading"!==t;return(0,a.jsx)("dialog",{open:!0,className:`ai-response-dialog status-${t}`,children:(0,a.jsxs)("article",{children:[(0,a.jsxs)("header",{children:[(0,a.jsxs)("div",{className:"ai-response__title",children:[(0,a.jsx)("span",{role:"img","aria-label":"AI",children:"\ud83e\udd16"}),(0,a.jsx)("span",{children:L[t]})]}),(0,a.jsx)("a",{className:"close",href:"#close-ai-response",onClick:e=>{e.preventDefault(),r()}})]}),(0,a.jsxs)("main",{children:["loading"===t&&(0,a.jsxs)("div",{className:"ai-response__loading",children:[(0,a.jsx)("span",{className:"spinner","aria-hidden":"true"}),(0,a.jsx)("p",{children:"Comparing your HDL with our AI reviewer..."})]}),"success"===t&&(0,a.jsx)("pre",{className:"ai-response__content",children:null!==s&&void 0!==s?s:"AI did not return any feedback."}),"error"===t&&(0,a.jsx)("div",{className:"ai-response__error",children:(0,a.jsx)("p",{children:null!==n&&void 0!==n?n:"Something went wrong while calling the AI."})}),"idle"===t&&(0,a.jsx)("div",{className:"ai-response__idle",children:(0,a.jsx)("p",{children:"Ready when you are!"})})]}),(0,a.jsxs)("footer",{children:[(0,a.jsx)("button",{onClick:r,children:"Close"}),o&&(0,a.jsx)("button",{className:"secondary",onClick:()=>{r(),null===i||void 0===i||i()},children:"Retry"})]})]})})},H=()=>{const{setStatus:e,localFsRoot:t}=(0,i.useContext)(A.L),{stores:s,setTool:o}=(0,i.useContext)(_.NQ),{tracking:c,filePicker:d}=(0,i.useContext)(D.BR),{state:u,actions:p,dispatch:h}=s.chip,[x,m]=(0,w.b)(u.files.hdl),[j,g]=(0,w.b)(u.files.tst),[f,v]=(0,w.b)(u.files.cmp),[b,L]=(0,w.b)(u.files.out),[H,$]=(0,w.b)(u.dir),[M,O]=(0,i.useState)(),[T,Z]=(0,i.useState)(!1),[U,V]=(0,i.useState)("idle"),[K,J]=(0,i.useState)(),[z,W]=(0,i.useState)();(0,i.useEffect)(()=>{M&&$(null===M||void 0===M?void 0:M.split("/").slice(0,-1).join("/"))},[M]),(0,i.useEffect)(()=>{o("chip")},[o]),(0,i.useEffect)(()=>{c.trackPage("/chip")},[c]),(0,i.useEffect)(()=>{c.trackEvent("action","setProject",u.controls.project),c.trackEvent("action","setChip",u.controls.chipName)},[]);const{triggerAi:X}=function({project:e,chipName:t,hdlContent:s},n={}){const r=(0,i.useCallback)(()=>E.includes(e)?t&&""!==t?s&&""!==s.trim()?void 0:"Current HDL file is empty.":"No chip is currently loaded. Please select a chip first.":`AI feature is only available for projects 1, 2, 3, or 5. Current project: ${e}`,[e,t,s]),a=(0,i.useCallback)(async()=>{var i;const a=r();var o;if(a)return console.log(a),void(null===(o=n.onError)||void 0===o||o.call(n,a));null===(i=n.onStart)||void 0===i||i.call(n);const l=`${t}.hdl`,c=new Blob([s],{type:"text/plain"}),d=new File([c],l,{type:"text/plain"}),u=new FormData;u.append("practiceFile",d),console.log("Sending request to AI endpoint...",{fileName:l,project:e,contentLength:s.length});try{var p;const e=await fetch("https://nand2tetrisai-881742200158.europe-west1.run.app/compare",{method:"POST",body:u});if(!e.ok){const t=await e.json().catch(()=>({error:"Unknown error"}));throw new Error(t.error||`Server error: ${e.status}`)}const t=await e.text();console.log("AI Response:",t),null===(p=n.onSuccess)||void 0===p||p.call(n,t)}catch(x){var h;const e=x instanceof Error?x.message:"An error occurred while comparing files";console.error("Error calling AI endpoint:",e),null===(h=n.onError)||void 0===h||h.call(n,e)}},[t,s,n,e,r]);return(0,i.useEffect)(()=>(window.ai=a,()=>{delete window.ai}),[a]),{triggerAi:a}}({project:u.controls.project,chipName:u.controls.chipName,hdlContent:x},{onStart:()=>{V("loading"),J(void 0),W(void 0),Z(!0)},onSuccess:e=>{V("success"),J(e),Z(!0)},onError:e=>{V("error"),W(e),Z(!0)}}),q=(0,i.useCallback)(()=>{Z(!1)},[]),Q=(0,i.useCallback)(()=>{p.eval(),c.trackEvent("action","eval")},[p,c]),Y=(0,i.useRef)(()=>{});Y.current=async(e={})=>{var t,s,n,r;const i=u.controls.usingBuiltin?e.hdl:null!==(t=e.hdl)&&void 0!==t?t:x;await p.updateFiles({hdl:i,tst:null!==(s=e.tst)&&void 0!==s?s:j,cmp:null!==(n=e.cmp)&&void 0!==n?n:f,tstPath:null!==(r=e.tstDir)&&void 0!==r?r:H})},(0,i.useEffect)(()=>{Y.current({tst:j,cmp:f,tstDir:H}),p.reset()},[j,f,H]);const G=(0,i.useRef)();(0,i.useEffect)(()=>(G.current=new class extends S.M{async reset(){await Y.current(),await p.reset()}finishFrame(){super.finishFrame(),h.current({action:"updateTestStep"})}async tick(){return await p.stepTest()}toggle(){h.current({action:"updateTestStep"})}},()=>{var e;null===(e=G.current)||void 0===e||e.stop()}),[Y,p,h]);const ee=(0,i.useMemo)(()=>({toggle(){p.clock(),c.trackEvent("action","toggleClock")},reset(){c.trackEvent("action","resetClock"),p.reset()}}),[p]),te=(0,i.useRef)(null),se=(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)("fieldset",{role:"group","data-tooltip":"Open an HDL file using this menu","data-placement":"bottom",children:[(0,a.jsx)("select",{value:u.controls.project,onChange:({target:{value:e}})=>{p.setProject(e)},"data-testid":"project-picker",children:u.controls.projects.map(e=>(0,a.jsx)("option",{value:e,children:`Project ${e.replace(/^0/,"")}`},e))}),(0,a.jsxs)("select",{value:u.controls.chipName,onChange:({target:{value:e}})=>{if(""!=e){let s=`/${u.controls.project}/${e}.hdl`;t||(s=`/projects${s}`),p.loadChip(s)}},"data-testid":"chip-picker",children:[""==u.controls.chipName&&(0,a.jsx)("option",{}),u.controls.chips.map(e=>(0,a.jsx)("option",{value:e,children:e},e))]})]})}),ne=(0,a.jsx)(F.Z,{className:"_hdl_panel",isEditorPanel:!0,header:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{tabIndex:0,children:"HDL"}),(0,a.jsxs)("label",{style:{visibility:(0,l.KQ)(u.controls.chipName)?"visible":"hidden"},children:[(0,a.jsx)("input",{type:"checkbox",role:"switch",checked:u.controls.usingBuiltin,onChange:()=>{p.toggleBuiltin(),de.reset()}}),(0,a.jsx)(n.x6,{id:"++LBSt"})]}),(0,a.jsx)("div",{style:{width:"30px"}}),(0,a.jsx)("div",{className:"flex-4",children:se}),(0,a.jsxs)("fieldset",{role:"group",children:[(0,a.jsx)("button",{"data-tooltip":"Open an HDL file directly","data-placement":"bottom",onClick:async()=>{const e=await d.select({suffix:"hdl"});p.loadChip(e.path)},children:"\ud83d\udcc2"}),(0,a.jsx)("a",{ref:te,style:{display:"none"}}),(0,a.jsx)("button",{onClick:async()=>{if(!te.current)return;const e=await p.getProjectFiles(),t=await(0,R.y)(e);te.current.href=t,te.current.download=`${u.controls.project}`,te.current.click(),URL.revokeObjectURL(t)},"data-tooltip":r.Ru._({id:"Ovrln6"}),"data-placement":"left",children:"\u2b07\ufe0f"}),(0,a.jsx)("button",{className:"ai-trigger-button","data-tooltip":"Send HDL to AI","data-placement":"bottom",onClick:X,disabled:""===u.controls.chipName,"aria-label":"Ask AI for feedback",children:"\ud83e\udd16"})]})]}),children:(0,a.jsx)(I.K,{className:"flex-1",value:x,error:u.controls.error,onChange:async e=>{m(e),u.controls.usingBuiltin||p.saveChip(e),Y.current(u.controls.usingBuiltin?{}:{hdl:e})},grammar:N.xP.parser,language:"hdl",disabled:u.controls.usingBuiltin||""==u.controls.chipName})}),[re,ie]=(0,i.useState)(!0),ae=()=>{e(r.Ru._({id:"Ow/xRO"}))},oe=()=>{u.sim.invalid?ae():Q()},le=(0,a.jsxs)("fieldset",{role:"group",children:[(0,a.jsx)("button",{onClick:oe,onKeyDown:oe,disabled:!u.sim.pending||!re,children:(0,a.jsx)(n.x6,{id:"J3L683"})}),(0,a.jsx)("button",{onClick:()=>{u.sim.invalid?ae():ee.reset()},style:{maxWidth:"initial"},disabled:!u.sim.clocked,children:(0,a.jsx)(n.x6,{id:"OfhWJH"})}),(0,a.jsxs)("button",{onClick:()=>{u.sim.invalid?ae():ee.toggle()},style:{minWidth:"7em",textAlign:"start"},disabled:!u.sim.clocked,children:[(0,a.jsx)(n.x6,{id:"3rHyAJ"}),":","\xa0",(0,a.jsx)(C.wr,{})]})]}),ce=function(e,t,s){return[...e.parts].map((e,n)=>[`${e.id}_${n}`,y(e,t,s)]).filter(([e,t])=>void 0!==t)}({parts:u.sim.chip},()=>{h.current({action:"updateChip"})},u.controls.visualizationParameters),de=new k.wG,ue=(0,a.jsx)(F.Z,{className:"_parts_panel",header:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(n.x6,{id:"C7rK3y"})," ",u.controls.chipName]}),le]}),children:u.sim.invalid?(0,a.jsx)(n.x6,{id:"RFMyN+"}):""!=u.controls.chipName&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(k.ZB.Provider,{value:de,children:(0,a.jsx)(k.vl,{sim:u.sim,toggle:p.toggle,setInputValid:ie,hideInternal:u.controls.usingBuiltin})}),ce.length>0&&(0,a.jsx)(F.p,{summary:(0,a.jsx)(n.x6,{id:"q3JCcX"}),open:!0,children:(0,a.jsx)("main",{children:ce.map(([e,t])=>t)})})]})}),pe=(0,a.jsx)(P.B,{runner:G,disabled:u.sim.invalid,prefix:u.controls.tests.length>1?(0,a.jsx)("select",{value:u.controls.testName,onChange:({target:{value:e}})=>{p.loadTest(e)},"data-testid":"test-picker",children:u.controls.tests.map(e=>(0,a.jsx)("option",{value:e,children:e},e))}):(0,a.jsx)(a.Fragment,{}),tst:[j,g,u.controls.span],cmp:[f,v],out:[b,L],setPath:O,speed:u.config.speed,onSpeedChange:e=>{h.current({action:"updateConfig",payload:{speed:e}})}});return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"Page ChipPage grid",children:[ne,ue,pe]}),(0,a.jsx)(B,{open:T,status:U,feedback:K,error:z,onClose:q,onRetry:X})]})},$=H}}]);