"use strict";(self.webpackChunk_nand2tetris_web=self.webpackChunk_nand2tetris_web||[]).push([[744],{5178:(e,t,a)=>{a.r(t),a.d(t,{CPU:()=>j,default:()=>y});var s=a(1391),n=a(1091),r=a(7437),c=a(64),i=a(4668),o=a(8878),l=a(9646),d=a(7022),u=a(910),m=a(6073),p=a(8029),h=a(3344),f=a(5168),x=a(9267),g=a(782);const j=()=>{const{filePicker:e}=(0,o.useContext)(p.BR),{setTool:t,stores:a}=(0,o.useContext)(h.NQ),{state:j,actions:y,dispatch:C}=a.cpu,{fs:S}=(0,o.useContext)(u.L),[v,k]=(0,l.b)(j.test.tst),[A,F]=(0,l.b)(j.test.out),[w,b]=(0,l.b)(j.test.cmp),[P,R]=(0,o.useState)(),[T,M]=(0,o.useState)(0);(0,o.useEffect)((()=>{t("cpu")}),[t]),(0,o.useEffect)((()=>{y.compileTest(v,w,P),y.reset()}),[v,w,P]);const N=(0,o.useRef)(),_=(0,o.useRef)(),[E,L]=(0,o.useState)(!1);(0,o.useEffect)((()=>(N.current=new class extends n.M{async tick(){return y.tick(),!1}finishFrame(){C.current({action:"update"})}reset(){y.reset()}toggle(){C.current({action:"update"})}},_.current=new class extends n.M{async tick(){return y.testStep()}finishFrame(){C.current({action:"update"})}reset(){y.reset()}toggle(){C.current({action:"update"})}},L(!0),()=>{var e,t;null===(e=N.current)||void 0===e||e.stop(),null===(t=_.current)||void 0===t||t.stop()})),[y,C]);return(0,g.jsxs)("div",{className:"Page CpuPage grid "+(2==j.config.screenScale?"large-screen":"normal"),children:[(0,g.jsx)(c.Ay,{name:"ROM",memory:j.sim.ROM,highlight:j.sim.PC,format:j.config.romFormat,fileSelect:async()=>{var t;const a=await e.selectAllowLocal({suffix:[".asm",".hack"]}),s=(0,m.uf)(a)?null!==(t=a.path.split("/").pop())&&void 0!==t?t:"":Array.isArray(a)?a[0].name:a.name;var n;return C.current({action:"setTitle",payload:s}),(0,m.uf)(a)?((async e=>{R(e),y.setPath(e),y.reset()})(a.path),{name:null!==(n=a.path.split("/").pop())&&void 0!==n?n:"",content:await S.readFile(a.path)}):(y.clearTest(),Array.isArray(a)?a[0]:a)},onSetFormat:e=>{C.current({action:"updateConfig",payload:{romFormat:e}})},onClear:()=>y.clear(),loadTooltip:{value:"Load an .asm or .hack file",placement:"right"}}),(0,g.jsx)(c.Ay,{name:"RAM",memory:j.sim.RAM,format:j.config.ramFormat,excludedFormats:["asm"],onChange:()=>{M(T+1)},onSetFormat:e=>{C.current({action:"updateConfig",payload:{ramFormat:e}})}}),(0,g.jsxs)(f.Z,{className:"IO",header:(0,g.jsx)(g.Fragment,{children:(0,g.jsx)("div",{className:"flex-1",children:E&&N.current&&(0,g.jsx)(d.T,{runner:N.current,speed:j.config.speed,onSpeedChange:e=>{C.current({action:"updateConfig",payload:{speed:e}})}})})}),children:[(0,g.jsx)(i.f,{memory:j.sim.Screen,showScaleControls:!0,scale:j.config.screenScale,onScale:e=>{C.current({action:"updateConfig",payload:{screenScale:e}})}},T),(0,g.jsx)(r.s,{update:()=>{C.current({action:"update"})},keyboard:j.sim.Keyboard}),(0,g.jsx)(f.p,{summary:(0,g.jsx)(s.x6,{id:"rdShiY"}),open:!0,children:(0,g.jsx)("main",{children:(0,g.jsx)("div",{children:(0,g.jsxs)("dl",{children:[(0,g.jsx)("dt",{children:"PC"}),(0,g.jsx)("dd",{children:j.sim.PC}),(0,g.jsx)("dt",{children:"A"}),(0,g.jsx)("dd",{children:j.sim.A}),(0,g.jsx)("dt",{children:"D"}),(0,g.jsx)("dd",{children:j.sim.D})]})})})})]}),E&&(0,g.jsx)(x.B,{runner:_,tst:[v,k,j.test.highlight],out:[A,F],cmp:[w,b],setPath:R,tstName:j.test.name,disabled:!j.test.valid,showName:j.tests.length<2,speed:j.config.testSpeed,onSpeedChange:e=>{C.current({action:"updateConfig",payload:{testSpeed:e}}),y.setAnimate(e<=2)},prefix:j.tests.length>1?(0,g.jsx)("select",{value:j.test.name,onChange:({target:{value:e}})=>{y.loadTest(e)},"data-testid":"test-picker",children:j.tests.map((e=>(0,g.jsx)("option",{value:e,children:e},e)))}):(0,g.jsx)(g.Fragment,{})})]})},y=j}}]);